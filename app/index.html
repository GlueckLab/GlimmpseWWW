<!DOCTYPE html>
<!--
* GLIMMPSE (General Linear Multivariate Model Power and Sample size)
* Copyright (C) 2017 Regents of the University of Colorado.
*
* This program is free software; you can redistribute it and/or
* modify it under the terms of the GNU General Public License
* as published by the Free Software Foundation; either version 2
* of the License, or (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License
* along with this program; if not, write to the Free Software
* Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-->
<html lang="en" id="ng-app" ng-app="glimmpse">

<head>
    <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <LINK REL="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <title>GLIMMPSE: General Linear Multivariate Model Power &amp; Sample Size</title>

    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-21939703-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <!-- replaced by gruntfile when building for mobile -->
    <!-- PHONEGAPJS -->

    <script type="text/javascript"
            src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
        imageFont: null,
        extensions: ["tex2jax.js"],
        tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
        MMLorHTML: { prefer: { Chrome: "HTML" } }
        });
    </script>

    <!-- build:js js/libraries.js -->
    <script src="lib/jquery.min.js"></script>
    <script src="lib/jquery-ui.min.js"></script>
    <script src="lib/jquery.form.min.js"></script>
    <script src="lib/highcharts.js"></script>
    <script src="lib/exporting.js"></script>
    <script src="lib/pluralize.js"></script>

    <!-- order matters here, so be careful if you edit -->
    <!-- Angular.js scripts -->
    <script src="lib/angular.min.js"></script>
    <script src="lib/angular-touch.js"></script>
    <script src="lib/ng-grid-2.0.7.min.js"></script>
    <script src="lib/highcharts-ng.js"></script>
    <!-- bootstrap plugins - load after jquery -->
    <script src="lib/bootstrap.min.js"></script>
    <script src="lib/ui-bootstrap-tpls-0.6.0.min.js"></script>

    <!-- endbuild -->

    <!-- app specific scripts -->
    <!-- build:js js/glimmpse.js -->
    <script src="js/app.js"></script>
    <script src="js/config.js"></script>
    <script src="js/services/matrixUtilities.js"></script>
    <script src="js/services/studyDesignService.js"></script>
    <script src="js/services/studyDesignMetaData.js"></script>
    <script src="js/services/powerService.js"></script>
    <script src="js/services/dropboxService.js"></script>
    <script src="js/directives.js"></script>
    <script src="js/controllers/controllers.js"></script>
    <!-- endbuild -->

    <!-- build:css css/glimmpse.css -->
    <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="css/ng-grid.css">
    <link type="text/css" rel="stylesheet" href="css/glimmpse.css">
    <!-- endbuild -->

    <script type="text/javascript">

        /*
         * Javascript to perform the Oauth2 workflow for connecting
         * the mobile version of GLIMMPSE to Dropbox
         */
        var authWindow = null;
        var typeOfService = undefined;

        /*
         * Initiate the dropbox Oauth workflow
         *
         * First, check if we already have a authentication code.
         * If not, then open an InAppBrowser window to allow the user
         * to authorize GLIMMPSE access to their dropbox.
         * Once a code is obtained, exchange it for an access token, and
         * call the angular function which performs the operation (save or upload)
         * which was originally requested by the user.
         */
        function dropboxStartOauth(requestedService) {
            typeOfService = requestedService;
            // check if we already have a authentication code
            var token = angular.element($('#fileNameDiv')).scope().dropboxService.getToken();
            if (token == null) {
                // the token had expired or is not available, so restart the Oauth process
                var authUrl = 'https://www.dropbox.com/1/oauth2/authorize?' + $.param({
                    <!-- @Client_Id@ -->
                    redirect_uri: 'http://localhost',
                    response_type: 'code'
                });
                authWindow = window.open(authUrl, '_blank', 'location=no');
                authWindow.addEventListener('loadstart', dropboxParseCodeAndContinueOauth, false);

            } else {
                if (typeOfService == 'uploadDesignFromDropbox') {
                    angular.element($('#fileNameDiv')).scope().updateDropboxFileList();
                }
            }
        }

        /*
        * Parse URL for Dropbox auth code and obtain an access token
        */
        function dropboxParseCodeAndContinueOauth(event) {

            // Parse the URL to obtain Dropbox authentication code
            var url = event.url;
            var code = /\?code=(.+)$/.exec(url);
            var error = /\?error=(.+)$/.exec(url);

            if (code || error) {
                // close the window after parsing the URL
                if (authWindow != null) authWindow.close();
            }

            if (code) {
                angular.element($('#fileNameDiv')).scope().dropboxService.setStatus('CONNECTING');
                $.post('https://api.dropbox.com/1/oauth2/token', {
                            code: code[1],
                            <!-- @Client_Id@ -->
                            <!-- @Client_Secret@ -->
                            redirect_uri: 'http://localhost',
                            grant_type: 'authorization_code'
                        },  function(data) {

                        }, "json"
                ).done(function(data) {
                            //alert("success for token auth");
                            token = data.access_token;
                            angular.element($('#fileNameDiv')).scope().dropboxService.setStatus('READY');
                            angular.element($('#fileNameDiv')).scope().dropboxService.storeToken(token);

                            if (typeOfService == 'uploadDesignFromDropbox') {
                                angular.element($('#fileNameDiv')).scope().updateDropboxFileList();
                            }
                        }
                ).fail(function() {
                            angular.element($('#fileNameDiv')).scope().dropboxService.setStatus('ERROR');
                        });
            } else if (error) {
                window.alert("Dropbox authentication failed.  Please try again");
            }
        }
    </script>

</head>

<body>

<div class="container" ng-controller="stateController">
    <!-- header bar -->
    <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="debug-border navbar-toggle" data-toggle="collapse" data-target="#collapsed-header">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/#">
                <span class="logo">GLIMMPSE</span>
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="collapsed-header">
            <ul class="nav navbar-nav">
                <li>
                    <!-- for web -->
                    <a ng-show="!isMobile" href="http://samplesizeshop.org" rel="external" target="_blank">SampleSizeShop.org</a>
                    <!-- for mobile -->
                    <a ng-show="isMobile" href="#" onclick="window.open('http://samplesizeshop.org', '_system', 'location=yes');">
                        SampleSizeShop.org
                    </a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Help <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a ng-show="!isMobile" href="http://samplesizeshop.org/education/tutorials/tutorials-for-selecting-and-using-various-study-designs/"
                               target="_blank">
                                Tutorials for common designs
                            </a>
                            <!-- for mobile -->
                            <a ng-show="isMobile" href="#"
                               onclick="window.open('http://samplesizeshop.org/education/tutorials/tutorials-for-selecting-and-using-various-study-designs/',
                                       '_system', 'location=yes');">
                                Tutorials for common designs
                            </a>
                        </li>
                        <li>
                            <a ng-show="!isMobile" href="http://samplesizeshop.org/files/2012/08/GLIMMPSEUserManual_v2.0.0.pdf" target="_blank">User Manual</a>
                            <!-- for mobile -->
                            <a ng-show="isMobile" href="#"
                               onclick="window.open('http://samplesizeshop.org/files/2012/08/GLIMMPSEUserManual_v2.0.0.pdf',
                                       '_system', 'location=yes');">
                                User Manual
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a ng-show="!isMobile" href="http://samplesizeshop.org/documentation/glimmpse/about/" target="_blank">
                                About GLIMMPSE
                            </a>
                            <!-- for mobile -->
                            <a ng-show="isMobile" href="#"
                               onclick="window.open('http://samplesizeshop.org/documentation/glimmpse/about/',
                                       '_system', 'location=yes');">
                                About GLIMMPSE
                            </a>
                        </li>
                        <li>
                            <a ng-show="!isMobile" href="http://samplesizeshop.org/documentation/glimmpse/" target="_blank">
                                Documentation
                            </a>
                            <!-- for mobile -->
                            <a ng-show="isMobile" href="#"
                               onclick="window.open('http://samplesizeshop.org/documentation/glimmpse/',
                                       '_system', 'location=yes');">
                                Documentation
                            </a>
                        </li>
                        <li>
                            <a ng-show="!isMobile" href="http://samplesizeshop.org/software-downloads/glimmpse/" target="_blank">
                                Downloads
                            </a>
                            <!-- for mobile -->
                            <a ng-show="isMobile" href="#"
                               onclick="window.open('http://samplesizeshop.org/software-downloads/glimmpse/',
                                       '_system', 'location=yes');">
                                Downloads
                            </a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a ng-show="!isMobile" href="feedback.html" target="_blank">Feedback</a>
                    <a ng-show="isMobile" href="#"
                       onclick="window.open('feedback.html',
                                       '_blank', 'location=yes');">
                        Feedback
                    </a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right" ng-show="getMode() != undefined">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <span class="glyphicon glyphicon-floppy-disk"></span> Save <b class="caret"></b>
                    </a>

                    <ul class="dropdown-menu">
                        <!-- Save options from the browser -->
                        <li ng-show="!isMobile">
                            <form name="saveForm" method='post' action="{{uriSave}}" target="_blank">
                                <div>
                                    <input type="hidden" name="filename" value="study.json"/>
                                    <input type="hidden" name="data" value='{{studyDesignJSON}}' />
                                </div>
                                <button type="submit" data-ng-click="updateStudyDesignJSON()">
                                    Design
                                </button>
                            </form>
                        </li>
                        <!-- <li role="presentation">
                            <div role="menuitem"  ng-show="getView()==glimmpseConstants.viewTypeResults">
                                <a href="">Save Report</a>
                            </div>
                        </li>    -->
                        <li ng-show="!isMobile">
                            <form name="saveResultsToCSVForm" method='post' action="{{uriSave}}" target="_blank">
                                <div>
                                    <input type="hidden" name="filename" value="results.csv"/>
                                    <input type="hidden" name="data" value='{{resultsCSV}}' />
                                </div>
                                <button type="submit" data-ng-click="updateResultsCSV()"
                                        ng-disabled="powerService.cachedResults == undefined">
                                    Results
                                </button>
                            </form>
                        </li>
                        <!-- Save obtains from mobile devices -->
                        <li ng-show="isMobile">
                            <div>
                                <button data-toggle="modal" data-target="#emailStudyDesignModal"
                                        data-ng-click="updateStudyDesignJSON()">
                                    Email Design
                                </button>
                            </div>
                        </li>
                        <li ng-show="isMobile">
                            <div>
                                <button data-toggle="modal" data-target="#saveStudyDesignModal"
                                        onclick="dropboxStartOauth('saveDesign')">
                                    Save Design to Dropbox
                                </button>
                            </div>
                        </li>
                        <li ng-show="isMobile">
                            <div>
                                <button data-toggle="modal" data-target="#emailResultsModal"
                                        data-ng-click="updateResultsCSV()"
                                        ng-disabled="powerService.cachedResults == undefined">
                                    Email Results
                                </button>
                            </div>
                        </li>
                        <li ng-show="isMobile">
                            <div>
                                <button data-toggle="modal" data-target="#saveResultsModal"
                                        onclick="dropboxStartOauth('saveResults')"
                                        ng-disabled="powerService.cachedResults == undefined">
                                    Save Results to Dropbox
                                </button>
                            </div>
                        </li>
                    </ul>
                </li>
                <li ng-show="!isMobile">
                    <form id="navUploadForm" enctype="multipart/form-data"
                          action="{{uriUpload}}">
                        <label class="none">
                            <span class="glyphicon glyphicon-open"></span> Upload
                            <input type="file" id="navBarUpload" name="file"
                                   onchange="angular.element(this).scope().uploadFile(this)"
                                   style="display:none;" />
                        </label>

                    </form>

                    <!--
                    <a href="#" ng-click="">
                        <span class="glyphicon glyphicon-open"></span> Load

                    </a> -->
                </li>

                <li ng-show="isMobile">
                    <form id="uploadFromDropboxForm" enctype="multipart/form-data">
                        <label class="none">
                            <span class="glyphicon glyphicon-open"></span> Upload From Dropbox
                            <input id="dropboxUpload" type="button"
                                   data-toggle="modal" data-target="#selectDropboxFileModal"
                                   onclick="dropboxStartOauth('uploadDesignFromDropbox')"
                                   style="display:none;" />
                        </label>
                    </form>

                </li>

                <li>
                    <a href="#" ng-click="reset()">
                        <span class="glyphicon glyphicon-trash"></span> Clear
                    </a>
                </li>

            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>

    <!-- Mode selection screen -->
    <div class="well shaded-box" ng-show="getMode() == undefined">
        <!--[if IE]>
        <div class="alert alert-warning">
            GLIMMPSE may not be compatible with some versions of Internet Explorer.
            If you experience problems running GLIMMPSE in your current browser, please try upgrading to IE 10
            or higher, or try an alternative browser such as Firefox, Safari, or Chrome.
        </div>
        <![endif]-->
        <div class="processing rounded-box" ng-show="processing==true">
            <label>Processing</label>
        </div>
        <h3>Start Your Study Design</h3>
        <p>
            Welcome to GLIMMPSE. The GLIMMPSE software calculates power and sample size for study designs
            with normally distributed outcomes. Select one of the options below to begin your power or sample size calculation.
        </p>

        <div class="row vmargin15 hpadding0 box gray-box rounded-box">
            <div class="col-md-3 col-sm-3 col-xs-12">
                <a href="#" class="btn btn-mode"
                   data-ng-click="setMode(glimmpseConstants.modeGuided)" >
                    Guided Study Design
                </a>
            </div>

            <div class="col-md-9 col-md-offset-0 col-sm-8 col-sm-offset-1 visible-sm visible-md visible-lg">
                <div class="mode-description rounded-box">
                    Build common study designs including ANOVA, ANCOVA, and regression with guidance from the
                    study design wizard. This mode is designed for applied researchers including
                    physicians, nurses, and other investigators.
                </div>
            </div>
        </div>
        <div class="row vmargin15 hpadding0 box gray-box rounded-box">
            <div class="col-md-3 col-sm-3 col-xs-12">
                <a href="#" class="btn btn-mode"
                   data-ng-click="setMode(glimmpseConstants.modeMatrix)" >
                    Matrix Study Design
                </a>
            </div>

            <div class="col-md-9 col-md-offset-0 col-sm-8 col-sm-offset-1  visible-sm visible-md visible-lg">
                <div class="mode-description rounded-box">
                    Directly enter the matrices for the general linear model. This mode is
                    designed for users with advanced statistical training.
                </div>
            </div>
        </div>

        <div class="row vmargin15 hpadding0 box gray-box rounded-box" >
            <div class="col-md-3 col-sm-3 col-xs-12">
                <form id="uploadForm" enctype="multipart/form-data" ng-show="!isMobile"
                      action="{{uriUpload}}">
                    <label class="btn btn-mode">
                        <span>Upload a Study Design</span>
                        <input type="file" id="uploader" name="file"
                               onchange="angular.element(this).scope().uploadFile(this)"
                               style="display:none;" />
                    </label>
                </form>

                <button class="btn btn-mode" onclick="dropboxStartOauth('uploadDesignFromDropbox')"
                        ng-show="isMobile"
                        data-toggle="modal" data-target="#selectDropboxFileModal">
                    Upload From Dropbox
                </button>
            </div>

            <div class="col-md-9 col-md-offset-0 col-sm-8 col-sm-offset-1  visible-sm visible-md visible-lg">
                <div class="mode-description rounded-box">
                    If you have previously saved a study design from GLIMMPSE, you may upload it here.
                    Click 'Upload a Study Design' to select your study design file.
                </div>
            </div>
        </div>
    </div>


    <!-- main Web application panel -->
    <div class="well white-box shaded-box" ng-show="getMode() != undefined">

        <!-- toolbox menu -->
        <div class="row hpadding30 hmargin15">
            <div class="pull-left visible-sm visible-xs">
                <a href="#" class="btn btn-sm btn-warning" ng-show="!isActive('/')">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                    Back
                </a>
            </div>
        </div>

        <!-- main application content-->
        <div class="row padding0">

            <!-- left nav -->
            <div class="col-md-3 visible-md visible-lg">
                <!-- Calculate button -->
                <div ng-show="calculateAllowed() && powerService.cachedResults == undefined">
                  <a class="btn btn-calculate" href="#/results/report"
                      ng-click="calculate()">
                    Calculate{{glimmpseConstants.debug
                                 ? ' (' + (getMode() == glimmpseConstants.modeGuided ? 'guided' : 'matrix') + ')'
                                 : ''}}
                  </a>
                </div>
                <div ng-show="!calculateAllowed() && powerService.cachedResults == undefined" >
                  <button data-ng-click="showIncompleteItemsDialog()"
                      class="btn btn-calculate-disabled"
                      data-toggle="modal" data-target="#incompleteDialog">
                    Calculate{{glimmpseConstants.debug
                                 ? ' (' + (getMode() == glimmpseConstants.modeGuided ? 'guided' : 'matrix') + ')'
                                 : ''}}
                  </button>
                </div>
                <!-- results nav -->
                <div ng-show="powerService.cachedResults != undefined">
                    <div class="panel-group">
                        <div class="panel panel-default">
                            <div class="btn btn-results">
                                Results{{glimmpseConstants.debug
                                           ? ' (' + (getMode() == glimmpseConstants.modeGuided ? 'guided' : 'matrix') + ')'
                                           : ''}}
                            </div>
                            <div class="panel-body" >
                                <div class="{{isActive('/results/report') && 'active'}}" >
                                    <a href="#/results/report">Table</a>
                                </div>
                                <div class="{{isActive('/results/plot') && 'active'}}" >
                                    <a href="#/results/plot" ng-show="studyDesign.powerCurveDescriptions != undefined">Plot</a>
                                    <label ng-show="studyDesign.powerCurveDescriptions == undefined">Plot</label>
                                </div>
                                <div class="{{isActive('/results/matrices') && 'active'}}" >
                                    <a href="#/results/matrices">Matrices</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- left nav -->
                <div class="vmargin15" >
                    <div class="panel-group" id="nav-accordion" >
                        <div class="panel panel-default">
                            <!-- start menu -->
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <button data-toggle="collapse" data-parent="#nav-accordion" href="#nav-start"
                                            ng-click="changeView('/')">
                                        Start
                                    </button>
                                </h4>
                            </div>
                            <div id="nav-start" class="panel-collapse collapse in">
                                <div class="panel-body">
                                    <div class="{{isActive('/solvingFor') && 'active'}} {{state.solvingFor}}" >
                                        <a href="#/solvingFor">Solving For</a>
                                    </div>
                                    <div class="{{isActive('/nominalPower') && 'active'}} {{state.nominalPower}}" >
                                        <a href="#/nominalPower"
                                           ng-show="viewAllowed(state.nominalPower)">Desired Power</a>
                                        <label ng-show="!viewAllowed(state.nominalPower)">Desired Power</label>
                                    </div>
                                </div>
                            </div>


                            <!-- ********* START GUIDED PANELS ********* -->

                            <!-- model menu -->
                            <div class="panel-heading" ng-show="getMode() == glimmpseConstants.modeGuided">
                                <h4 class="panel-title">
                                    <button data-toggle="collapse" data-parent="#nav-accordion" href="#nav-model"
                                            ng-click="changeView('/modelIntro')">Model</button>
                                </h4>
                            </div>
                            <div id="nav-model" class="panel-collapse collapse"
                                 ng-show="getMode() == glimmpseConstants.modeGuided">
                                <div class="panel-body">
                                    <div class="{{isActive('/isu') && 'active'}} {{state.isu}}" >
                                        <a href="#/isu">Clustering</a>
                                    </div>
                                    <div class="{{isActive('/predictors') && 'active'}} {{state.predictors}}" >
                                        <a href="#/predictors">Predictors and Groups</a>
                                    </div>
                                    <div class="{{isActive('/covariates') && 'active'}} {{state.covariates}}" >
                                        <a href="#/covariates">Covariate</a>
                                    </div>
                                    <div class="{{isActive('/responseVariables') && 'active'}} {{state.responseVariables}}" >
                                        <a href="#/responseVariables">Response Variables</a>
                                    </div>
                                    <div class="{{isActive('/repeatedMeasures') && 'active'}} {{state.repeatedMeasures}}" >
                                        <a href="#/repeatedMeasures">Repeated Measures</a>
                                    </div>
                                    <div class="{{isActive('/groupSizes') && 'active'}} {{state.groupSizes}}" >
                                        <a href="#/groupSizes" ng-show="viewAllowed(state.groupSizes)">Group Sizes</a>
                                        <label ng-show="!viewAllowed(state.groupSizes)">Group Sizes</label>
                                    </div>
                                </div>
                            </div>
                            <!-- hypothesis panel -->
                            <div class="panel-heading" ng-show="getMode() == glimmpseConstants.modeGuided">
                                <h4 class="panel-title">
                                    <button data-toggle="collapse" data-parent="#nav-accordion" href="#nav-hypothesis"
                                            ng-click="changeView('/hypothesisIntro')">Hypothesis</button>
                                </h4>
                            </div>
                            <div id="nav-hypothesis" class="panel-collapse collapse"
                                 ng-show="getMode() == glimmpseConstants.modeGuided">
                                <div class="panel-body">
                                    <div class="{{isActive('/hypothesis') && 'active'}} {{state.hypothesis}}" >
                                        <a href="#/hypothesis" ng-show="viewAllowed(state.hypothesis)">Hypothesis</a>
                                        <label ng-show="!viewAllowed(state.hypothesis)">Hypothesis</label>
                                    </div>
                                    <div class="{{isActive('/test') && 'active'}} {{state.test}}" >
                                        <a href="#/test">Statistical Tests</a>
                                    </div>
                                    <div class="{{isActive('/typeIError') && 'active'}} {{state.typeIError}}" >
                                        <a href="#/typeIError">Type I Error Rate</a>
                                    </div>
                                </div>
                            </div>
                            <!-- means panel -->
                            <div class="panel-heading" ng-show="getMode() == glimmpseConstants.modeGuided">
                                <h4 class="panel-title">
                                    <button data-toggle="collapse" data-parent="#nav-accordion" href="#nav-means"
                                            ng-click="changeView('/meansIntro')">Means</button>
                                </h4>
                            </div>
                            <div id="nav-means" class="panel-collapse collapse"
                                 ng-show="getMode() == glimmpseConstants.modeGuided">
                                <div class="panel-body">
                                    <div class="{{isActive('/means') && 'active'}} {{state.means}}" >
                                        <a href="#/means" ng-show="viewAllowed(state.means)">Means</a>
                                        <label ng-show="!viewAllowed(state.means)">Means</label>
                                    </div>
                                    <div class="{{isActive('/meansScale') && 'active'}} {{state.meansScale}}" >
                                        <a href="#/meansScale">Scale Factors</a>
                                    </div>
                                </div>
                            </div>
                            <!-- variability panel -->
                            <div class="panel-heading" ng-show="getMode() == glimmpseConstants.modeGuided">
                                <h4 class="panel-title">
                                    <button data-toggle="collapse" data-parent="#nav-accordion" href="#nav-variability"
                                            ng-click="changeView('/variabilityIntro')">Variability</button>
                                </h4>
                            </div>
                            <div id="nav-variability" class="panel-collapse collapse"
                                 ng-show="getMode() == glimmpseConstants.modeGuided">
                                <div class="panel-body">
                                    <div class="{{isActive('/variabilityWithin') && 'active'}} {{state.variabilityWithin}}" >
                                        <a href="#/variabilityWithin" ng-show="viewAllowed(state.variabilityWithin)">Within-Participant</a>
                                        <label ng-show="!viewAllowed(state.variabilityWithin)">Within-Participant</label>
                                    </div>
                                    <div class="{{isActive('/variabilityCovariate') && 'active'}} {{state.variabilityCovariate}}" >
                                        <a href="#/variabilityCovariate" ng-show="viewAllowed(state.variabilityCovariate)">Covariate</a>
                                        <label ng-show="!viewAllowed(state.variabilityCovariate)">Covariate</label>
                                    </div>
                                    <div class="{{isActive('/variabilityScale') && 'active'}} {{state.variabilityScale}}" >
                                        <a href="#/variabilityScale">Scale Factors</a>
                                    </div>
                                </div>
                            </div>

                            <!-- ********* END GUIDED PANELS ********* -->

                            <!-- ********* START MATRIX PANELS *********-->
                            <!-- design -->
                            <div class="panel-heading" ng-show="getMode() == glimmpseConstants.modeMatrix">
                                <h4 class="panel-title">
                                    <button data-toggle="collapse" data-parent="#nav-accordion" href="#nav-design"
                                            ng-click="changeView('/matrixDesignIntro')">Design</button>
                                </h4>
                            </div>
                            <div id="nav-design" class="panel-collapse collapse" ng-show="getMode() == glimmpseConstants.modeMatrix">
                                <div class="panel-body">
                                    <div class="{{isActive('/designEssence') && 'active'}} {{state.designEssence}}" >
                                        <a href="#/designEssence">Design Essence</a>
                                    </div>
                                    <div class="{{isActive('/covariates') && 'active'}} {{state.covariates}}" >
                                        <a href="#/covariates">Covariate</a>
                                    </div>
                                    <div class="{{isActive('/smallestGroupSize') && 'active'}} {{state.smallestGroupSize}}" >
                                        <a href="#/smallestGroupSize"
                                           ng-show="viewAllowed(state.smallestGroupSize)">Smallest Group Size</a>
                                        <label ng-show="!viewAllowed(state.smallestGroupSize)">
                                            Smallest Group Size
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Regression coefficients -->
                            <div class="panel-heading" ng-show="getMode() == glimmpseConstants.modeMatrix">
                                <h4 class="panel-title">
                                    <button data-toggle="collapse" data-parent="#nav-accordion" href="#nav-coefficients"
                                            ng-click="changeView('/matrixCoefficientsIntro')">Coefficients</button>
                                </h4>
                            </div>
                            <div id="nav-coefficients" class="panel-collapse collapse" ng-show="getMode() == glimmpseConstants.modeMatrix">
                                <div class="panel-body">
                                    <div class="{{isActive('/beta') && 'active'}} {{state.beta}}" >
                                        <a href="#/beta">Beta Coefficients</a>
                                    </div>
                                    <div class="{{isActive('/meansScale') && 'active'}} {{state.meansScale}}" >
                                        <a href="#/meansScale">Beta Scale Factors</a>
                                    </div>
                                </div>
                            </div>

                            <!-- Hypothesis -->
                            <div class="panel-heading" ng-show="getMode() == glimmpseConstants.modeMatrix">
                                <h4 class="panel-title">
                                    <button data-toggle="collapse" data-parent="#nav-accordion" href="#nav-contrasts"
                                            ng-click="changeView('/matrixHypothesisIntro')">Hypothesis</button>
                                </h4>
                            </div>
                            <div id="nav-contrasts" class="panel-collapse collapse" ng-show="getMode() == glimmpseConstants.modeMatrix">
                                <div class="panel-body">
                                    <div class="{{isActive('/betweenContrast') && 'active'}} {{state.betweenContrast}}" >
                                        <a href="#/betweenContrast">Between-Participant Contrast</a>
                                    </div>
                                    <div class="{{isActive('/withinContrast') && 'active'}} {{state.withinContrast}}" >
                                        <a href="#/withinContrast">Within-Participant Contrast</a>
                                    </div>
                                    <div class="{{isActive('/thetaNull') && 'active'}} {{state.thetaNull}}" >
                                        <a href="#/thetaNull">Null Hypothesis Matrix</a>
                                    </div>
                                    <div class="{{isActive('/test') && 'active'}} {{state.test}}" >
                                        <a href="#/test">Statistical Tests</a>
                                    </div>
                                    <div class="{{isActive('/typeIError') && 'active'}} {{state.typeIError}}" >
                                        <a href="#/typeIError">Type I Error Rate</a>
                                    </div>
                                </div>
                            </div>

                            <!-- Variability -->
                            <div class="panel-heading" ng-show="getMode() == glimmpseConstants.modeMatrix">
                                <h4 class="panel-title">
                                    <button data-toggle="collapse" data-parent="#nav-accordion" href="#nav-covariance"
                                            ng-click="changeView('/matrixVariabilityIntro')">Variability</button>
                                </h4>
                            </div>
                            <div id="nav-covariance" class="panel-collapse collapse" ng-show="getMode() == glimmpseConstants.modeMatrix">
                                <div class="panel-body">
                                    <div class="{{isActive('/sigmaE') && 'active'}} {{state.sigmaE}}">
                                        <a href="#/sigmaE" ng-show="viewAllowed(state.sigmaE)">Error Covariance</a>
                                        <label ng-show="!viewAllowed(state.sigmaE)">Error Covariance</label>
                                    </div>
                                    <div class="{{isActive('/sigmaY') && 'active'}} {{state.sigmaY}}">
                                        <a href="#/sigmaY" ng-show="viewAllowed(state.sigmaY)">Outcomes Covariance</a>
                                        <label ng-show="!viewAllowed(state.sigmaY)">Outcomes Covariance</label>
                                    </div>
                                    <div class="{{isActive('/sigmaG') && 'active'}} {{state.sigmaG}}" >
                                        <a href="#/sigmaG" ng-show="viewAllowed(state.sigmaG)">Variance of Covariate</a>
                                        <label ng-show="!viewAllowed(state.sigmaG)">Covariate</label>
                                    </div>
                                    <div class="{{isActive('/sigmaYG') && 'active'}} {{state.sigmaYG}}" >
                                        <a href="#/sigmaYG" ng-show="viewAllowed(state.sigmaYG)">Outcomes and Covariate</a>
                                        <label ng-show="!viewAllowed(state.sigmaYG)">Outcomes and Covariate</label>
                                    </div>
                                    <div class="{{isActive('/variabilityScale') && 'active'}} {{state.variabilityScale}}" >
                                        <a href="#/variabilityScale">Scale Factors</a>
                                    </div>
                                </div>
                            </div>

                            <!-- ********** END MATRIX PANELS ********** -->

                            <!-- options -->
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <button data-toggle="collapse" data-parent="#nav-accordion" href="#nav-options"
                                            ng-click="changeView('/optionsIntro')">Options</button>
                                </h4>
                            </div>
                            <div id="nav-options" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <div class="{{isActive('/powerMethod') && 'active'}} {{state.powerMethod}}" >
                                        <a href="#/powerMethod" ng-show="viewAllowed(state.powerMethod)">Power Method</a>
                                        <label ng-show="!viewAllowed(state.powerMethod)">Power Method</label>
                                    </div>
                                    <div class="{{isActive('/confidenceIntervals') && 'active'}} {{state.confidenceIntervals}}">
                                        <a href="#/confidenceIntervals">Confidence Intervals</a>
                                    </div>
                                    <div class="{{isActive('/plotOptions') && 'active'}} {{state.plotOptions}}" >
                                        <a href="#/plotOptions" ng-show="viewAllowed(state.plotOptions)">Power Curve</a>
                                        <label ng-show="!viewAllowed(state.plotOptions)">Power Curve</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- main content area with toolbar -->
            <div class="col-md-9 col-lg-9 col-xs-12 col-sm-12">
                <div class="processing rounded-box" ng-show="processing==true">
                    <label>Processing</label>
                </div>
                <div class="well white-box">
                    <div class="padding10" ng-view=""></div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="incompleteDialog" tabindex="-1"
             role="dialog" aria-labelledby="incompleteDialogModal" aria-hidden="true">
            <div class="modal-dialog rounded-box white-box">
                <div class="model-content">
                    <div class="modal-header">
                        <h3>The following items are incomplete</h3>
                    </div>
                    <div class="modal-body">
                        <div ng-repeat="view in incompleteViews">
                            {{view}}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-warning" data-dismiss="modal" aria-hidden="true">OK</button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="emailStudyDesignModal" tabindex="-1"
             role="dialog" aria-labelledby="emailStudyDesignModal" aria-hidden="true">
            <form id="emailDesignForm" enctype="multipart/form-data"
                  action="{{uriScripts}}studyDesign_email.php" name="emailDesignForm" method="post">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Send your study design by email</h3>
                            <label>Fill in the information below and click "Send" to email your study design.
                                The recipient will receive an email from samplesizeshop@gmail.com.</label>
                        </div>
                        <div class="modal-body">
                            <div class="processing rounded-box" ng-show="designEmailProcessing">
                                <label>Processing</label>
                            </div>
                            <div class="alert alert-success" ng-show="!designEmailProcessing && designEmailSuccess !== undefined && designEmailSuccess">
                                Your email has been sent.
                            </div>
                            <div class="alert alert-danger" ng-show="!designEmailProcessing && designEmailSuccess !== undefined && !designEmailSuccess">
                                We're sorry, but we were unable to submit your request at this time.  Please try again.
                            </div>
                            <div class="well">

                                <div>
                                    <input type="hidden" name="filename" value="study.json"/>
                                    <input type="hidden" name="data" value='{{studyDesignJSON}}' />
                                </div>
                                <div class="form-group">
                                    <label>Recipient Name</label>
                                    <input class="form-control" type="text" placeholder="Enter the recipient's name" name="name"
                                           ng-model="designEmail.name" required />
                                </div>
                                <div class="form-group">
                                    <label>Recipient Email Address</label>
                                    <input class="form-control" type="email" placeholder="Enter the recipient's email address"
                                           name="email" ng-model="designEmail.email" required />
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" onclick="angular.element(this).scope().sendDesignEmail(this)"
                                    class="btn btn-primary" aria-hidden="true" ng-disabled="!emailDesignForm.$valid">
                                Send
                            </button>
                            <button class="btn btn-warning" data-dismiss="modal" ng-click="designEmailSuccess = undefined"
                                    aria-hidden="true">Close</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="emailResultsModal" tabindex="-1"
             role="dialog" aria-labelledby="emailResultsModal" aria-hidden="true">
            <form id="emailResultsForm" enctype="multipart/form-data"
                  action="{{uriScripts}}powerResults_email.php" name="emailResultsForm" method="post">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Send your power results by email</h3>
                            <label>Fill in the information below and click "Send" to email your power results.
                                The recipient will receive an email from samplesizeshop@gmail.com.</label>
                        </div>
                        <div class="modal-body">
                            <div class="processing rounded-box" ng-show="resultsEmailProcessing">
                                <label>Processing</label>
                            </div>
                            <div class="alert alert-success" ng-show="!resultsEmailProcessing && resultsEmailSuccess !== undefined && resultsEmailSuccess">
                                Your email has been sent.
                            </div>
                            <div class="alert alert-danger" ng-show="!resultsEmailProcessing && resultsEmailSuccess !== undefined && !resultsEmailSuccess">
                                We're sorry, but we were unable to submit your request at this time.  Please try again.
                            </div>
                            <div class="well">
                                <div>
                                    <input type="hidden" name="resultsFilename" value="results.csv"/>
                                    <input type="hidden" name="resultsData" value='{{resultsCSV}}' />
                                </div>
                                <div class="form-group">
                                    <label>Recipient Name</label>
                                    <input class="form-control" type="text" placeholder="Enter your name" name="name"
                                           ng-model="resultsEmail.name" required />
                                </div>
                                <div class="form-group">
                                    <label>Recipient Email Address</label>
                                    <input class="form-control" type="email" placeholder="Enter your email address"
                                           name="email" ng-model="resultsEmail.email" required />
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" onclick="angular.element(this).scope().sendResultsEmail(this)"
                                    class="btn btn-primary" aria-hidden="true" ng-disabled="!emailResultsForm.$valid">
                                Send
                            </button>
                            <button class="btn btn-warning" data-dismiss="modal" ng-click="resultsEmailSuccess = undefined"
                                    aria-hidden="true">Close</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="saveStudyDesignModal" tabindex="-1"
             role="dialog" aria-labelledby="saveStudyDesignModal" aria-hidden="true">

            <form id="saveDesignDropboxForm" enctype="multipart/form-data"
                  name="saveDesignDropboxForm" method="post">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Save your study design to Dropbox</h3>
                            <label>Type the file name below and click "Save" to save your study design.
                                The file will be saved in the "glimmpse" folder in your Dropbox.</label>
                        </div>
                        <div class="modal-body">
                            <div class="processing rounded-box" ng-show="dropboxService.getStatus() == 'CONNECTING'">
                                <label>Connecting to Dropbox</label>
                            </div>
                            <div class="processing rounded-box" ng-show="dropboxService.getStatus() == 'PROCESSING'">
                                <label>Saving to Dropbox</label>
                            </div>
                            <div class="alert alert-success" ng-show="dropboxService.getStatus() == 'SUCCESS'">
                                Your file has been saved to your Dropbox folder as "glimmpseDesigns/{{dropboxDesignFilename}}.json".
                            </div>

                            <div class="alert alert-danger" ng-show="dropboxService.getStatus() == 'ERROR'">
                                Request to the dropbox server failed. Please try again later.
                            </div>

                            <div class="well" ng-show="dropboxService.getStatus() == 'READY'">
                                <div class="form-group" id="fileNameDiv">
                                    <label>File Name</label>
                                    <input class="form-control" type="text" placeholder="Enter the file name"
                                           ng-model="dropboxDesignFilename" required />
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary"
                                    ng-disabled="!saveDesignDropboxForm.$valid || dropboxService.getStatus() != 'READY'"
                                    ng-click="saveDropboxDesignFile()">
                                Save
                            </button>
                            <button class="btn btn-warning" data-dismiss="modal"
                                    type="submit"
                                    ng-click="dropboxService.setStatus('READY')">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>


        <!-- Modal -->
        <div class="modal fade" id="saveResultsModal" tabindex="-1"
             role="dialog" aria-labelledby="saveResultsModal" aria-hidden="true">

            <form id="saveResultsDropboxForm" enctype="multipart/form-data"
                  name="saveResultsDropboxForm" method="post">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Save your power results to dropbox</h3>
                            <label>Type the file name below and click "Save" to save your power results.
                                The file will be saved in your Dropbox folder.</label>
                        </div>
                        <div class="modal-body">
                            <div class="processing rounded-box" ng-show="dropboxService.getStatus() == 'CONNECTING'">
                                <label>Connecting to Dropbox</label>
                            </div>
                            <div class="processing rounded-box" ng-show="dropboxService.getStatus() == 'PROCESSING'">
                                <label>Saving to Dropbox</label>
                            </div>
                            <div class="alert alert-success" ng-show="dropboxService.getStatus() == 'SUCCESS'">
                                Your results has been saved to your Dropbox folder as "glimmpseDesigns/{{dropboxResultsFilename}}.csv".
                            </div>

                            <div class="alert alert-danger" ng-show="dropboxService.getStatus() == 'ERROR'">
                                Request to the dropbox server failed. Please try again later.
                            </div>

                            <div class="well" ng-show="dropboxService.getStatus() == 'READY'">
                                <div class="form-group">
                                    <label>File Name</label>
                                    <input class="form-control" type="text" placeholder="Enter the file name"
                                           ng-model="dropboxResultsFilename" required />
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary"
                                    ng-disabled="!saveResultsDropboxForm.$valid || dropboxService.getStatus() != 'READY'"
                                    ng-click="saveDropboxResultsFile()">
                                Save
                            </button>
                            <button class="btn btn-warning" data-dismiss="modal"
                                    type="submit"
                                    ng-click="dropboxService.setStatus('READY')">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="selectDropboxFileModal" tabindex="-1"
         role="dialog" aria-labelledby="selectDropboxFileModal" aria-hidden="true">

        <form id="selectDropboxFileForm" enctype="multipart/form-data"
              name="selectDropboxFileForm" method="post">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Select a study design from your Dropbox</h3>
                        <label>Click on a study design file below to upload your study design.
                        </label>
                    </div>
                    <div class="modal-body">

                        <div class="modal-body">
                            <div class="processing rounded-box" ng-show="dropboxService.getStatus() == 'CONNECTING'">
                                <label>Retrieving study design files</label>
                            </div>
                            <div class="processing rounded-box" ng-show="dropboxService.getStatus() == 'PROCESSING'">
                                <label>Processing</label>
                            </div>
                            <div class="alert alert-danger" ng-show="dropboxService.getStatus() == 'ERROR'">
                                Request to the dropbox server failed. Please try again later.
                            </div>
                            <div class="alert alert-success" ng-show="dropboxService.getStatus() == 'SUCCESS'">
                                Your study design has been uploaded.  Click "Close" to continue.
                            </div>
                            <div class="well" ng-show="dropboxService.getStatus() == 'READY'">
                                <div class="vmargin5" ng-repeat="file in dropboxFileList track by $id($index)">
                                    <a href="#" ng-click="uploadFileFromDropbox(file.path)">
                                        {{file.path}}
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-warning" data-dismiss="modal"
                                    ng-click="dropboxService.setStatus('READY');setMode(studyDesign.viewTypeEnum);setView(glimmpseConstants.viewTypeStudyDesign);"
                                    aria-hidden="true">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- footer -->
    <div class="row">
        <div class="col-md-12 text-center vmargin15">
          <small>
            <div>Copyright 2017 University of Colorado Denver. GLIMMPSE is released under the
                <a href="http://www.gnu.org/licenses/gpl-2.0.html">GNU General Public License, version 2</a>.
            </div>
            <br/>
            <div>
                GLIMMPSE version @VERSION@ is currently funded by NIH/NIGMS 9R01GM121081-05 to the University of Colorado Denver (Dana Dabelea, Deborah H. Glueck, Keith E. Muller MPI), and by NIH/NIGMS 5R25GM111901-03 to the University of Florida (Deborah H. Glueck, Keith E. Muller MPI). Explanatory material mirrors material developed for NIH/NLM 5G13LM011879-03, awarded to the University of Florida (Deborah H. Glueck, Keith E. Muller, MPI).
            </div>
            <br/>
            <div>
                Previous funding was provided by NIH/NIDCR 1 R01 DE020832-01A1 to the University of Florida (Keith E. Muller, PI; Deborah Glueck, University of Colorado site PI) and by an American Recovery and Re-investment Act supplement (3K07CA088811-06S) for NIH/NCI grant K07CA088811, awarded to the University of Colorado Denver (Deborah H. Glueck, PI).
            </div>
          </small>
        </div>
    </div>
</div>

</body>
</html>
